CREATE OR REPLACE FUNCTION usaspending_contract_update_child()
RETURNS TRIGGER AS $$
DECLARE tablename TEXT;
DECLARE statement TEXT;

BEGIN
    tablename := 'usaspending_contract_' || trim(to_char(NEW.fiscal_year, '9999'));
    statement := 'UPDATE usaspending_contract_' || tablename || ' SET "unique_transaction_id" = ' || NEW.unique_transaction_id || ',   "transaction_status" = ' || NEW.transaction_status || ',   "obligatedamount" = ' || NEW.obligatedamount || ',   "baseandexercisedoptionsvalue" = ' || NEW.baseandexercisedoptionsvalue || ',   "baseandalloptionsvalue" = ' || NEW.baseandalloptionsvalue || ',   "maj_agency_cat" = ' || NEW.maj_agency_cat || ',   "mod_agency" = ' || NEW.mod_agency || ',   "maj_fund_agency_cat" = ' || NEW.maj_fund_agency_cat || ',   "contractingofficeagencyid" = ' || NEW.contractingofficeagencyid || ',   "contractingofficeid" = ' || NEW.contractingofficeid || ',   "fundingrequestingagencyid" = ' || NEW.fundingrequestingagencyid || ',   "fundingrequestingofficeid" = ' || NEW.fundingrequestingofficeid || ',   "fundedbyforeignentity" = ' || NEW.fundedbyforeignentity || ',   "signeddate" = ' || NEW.signeddate || ',   "effectivedate" = ' || NEW.effectivedate || ',   "currentcompletiondate" = ' || NEW.currentcompletiondate || ',   "ultimatecompletiondate" = ' || NEW.ultimatecompletiondate || ',   "lastdatetoorder" = ' || NEW.lastdatetoorder || ',   "contractactiontype" = ' || NEW.contractactiontype || ',   "reasonformodification" = ' || NEW.reasonformodification || ',   "typeofcontractpricing" = ' || NEW.typeofcontractpricing || ',   "priceevaluationpercentdifference" = ' || NEW.priceevaluationpercentdifference || ',   "subcontractplan" = ' || NEW.subcontractplan || ',   "lettercontract" = ' || NEW.lettercontract || ',   "multiyearcontract" = ' || NEW.multiyearcontract || ',   "performancebasedservicecontract" = ' || NEW.performancebasedservicecontract || ',   "majorprogramcode" = ' || NEW.majorprogramcode || ',   "contingencyhumanitarianpeacekeepingoperation" = ' || NEW.contingencyhumanitarianpeacekeepingoperation || ',   "contractfinancing" = ' || NEW.contractfinancing || ',   "costorpricingdata" = ' || NEW.costorpricingdata || ',   "costaccountingstandardsclause" = ' || NEW.costaccountingstandardsclause || ',   "descriptionofcontractrequirement" = ' || NEW.descriptionofcontractrequirement || ',   "purchasecardaspaymentmethod" = ' || NEW.purchasecardaspaymentmethod || ',   "numberofactions" = ' || NEW.numberofactions || ',   "nationalinterestactioncode" = ' || NEW.nationalinterestactioncode || ',   "progsourceagency" = ' || NEW.progsourceagency || ',   "progsourceaccount" = ' || NEW.progsourceaccount || ',   "progsourcesubacct" = ' || NEW.progsourcesubacct || ',   "account_title" = ' || NEW.account_title || ',   "rec_flag" = ' || NEW.rec_flag || ',   "typeofidc" = ' || NEW.typeofidc || ',   "multipleorsingleawardidc" = ' || NEW.multipleorsingleawardidc || ',   "programacronym" = ' || NEW.programacronym || ',   "vendorname" = ' || NEW.vendorname || ',   "vendoralternatename" = ' || NEW.vendoralternatename || ',   "vendorlegalorganizationname" = ' || NEW.vendorlegalorganizationname || ',   "vendordoingasbusinessname" = ' || NEW.vendordoingasbusinessname || ',   "divisionname" = ' || NEW.divisionname || ',   "divisionnumberorofficecode" = ' || NEW.divisionnumberorofficecode || ',   "vendorenabled" = ' || NEW.vendorenabled || ',   "vendorlocationdisableflag" = ' || NEW.vendorlocationdisableflag || ',   "ccrexception" = ' || NEW.ccrexception || ',   "streetaddress" = ' || NEW.streetaddress || ',   "streetaddress2" = ' || NEW.streetaddress2 || ',   "streetaddress3" = ' || NEW.streetaddress3 || ',   "city" = ' || NEW.city || ',   "state" = ' || NEW.state || ',   "zipcode" = ' || NEW.zipcode || ',   "vendorcountrycode" = ' || NEW.vendorcountrycode || ',   "vendor_state_code" = ' || NEW.vendor_state_code || ',   "vendor_cd" = ' || NEW.vendor_cd || ',   "congressionaldistrict" = ' || NEW.congressionaldistrict || ',   "vendorsitecode" = ' || NEW.vendorsitecode || ',   "vendoralternatesitecode" = ' || NEW.vendoralternatesitecode || ',   "dunsnumber" = ' || NEW.dunsnumber || ',   "parentdunsnumber" = ' || NEW.parentdunsnumber || ',   "phoneno" = ' || NEW.phoneno || ',   "faxno" = ' || NEW.faxno || ',   "registrationdate" = ' || NEW.registrationdate || ',   "renewaldate" = ' || NEW.renewaldate || ',   "mod_parent" = ' || NEW.mod_parent || ',   "locationcode" = ' || NEW.locationcode || ',   "statecode" = ' || NEW.statecode || ',   "pop_state_code" = ' || NEW.pop_state_code || ',   "placeofperformancecountrycode" = ' || NEW.placeofperformancecountrycode || ',   "placeofperformancezipcode" = ' || NEW.placeofperformancezipcode || ',   "pop_cd" = ' || NEW.pop_cd || ',   "placeofperformancecongressionaldistrict" = ' || NEW.placeofperformancecongressionaldistrict || ',   "psc_cat" = ' || NEW.psc_cat || ',   "productorservicecode" = ' || NEW.productorservicecode || ',   "systemequipmentcode" = ' || NEW.systemequipmentcode || ',   "claimantprogramcode" = ' || NEW.claimantprogramcode || ',   "principalnaicscode" = ' || NEW.principalnaicscode || ',   "informationtechnologycommercialitemcategory" = ' || NEW.informationtechnologycommercialitemcategory || ',   "gfe_gfp" = ' || NEW.gfe_gfp || ',   "useofepadesignatedproducts" = ' || NEW.useofepadesignatedproducts || ',   "recoveredmaterialclauses" = ' || NEW.recoveredmaterialclauses || ',   "seatransportation" = ' || NEW.seatransportation || ',   "contractbundling" = ' || NEW.contractbundling || ',   "consolidatedcontract" = ' || NEW.consolidatedcontract || ',   "countryoforigin" = ' || NEW.countryoforigin || ',   "placeofmanufacture" = ' || NEW.placeofmanufacture || ',   "manufacturingorganizationtype" = ' || NEW.manufacturingorganizationtype || ',   "agencyid" = ' || NEW.agencyid || ',   "piid" = ' || NEW.piid || ',   "modnumber" = ' || NEW.modnumber || ',   "transactionnumber" = ' || NEW.transactionnumber || ',   "fiscal_year" = ' || NEW.fiscal_year || ',   "idvagencyid" = ' || NEW.idvagencyid || ',   "idvpiid" = ' || NEW.idvpiid || ',   "idvmodificationnumber" = ' || NEW.idvmodificationnumber || ',   "solicitationid" = ' || NEW.solicitationid || ',   "extentcompeted" = ' || NEW.extentcompeted || ',   "reasonnotcompeted" = ' || NEW.reasonnotcompeted || ',   "numberofoffersreceived" = ' || NEW.numberofoffersreceived || ',   "commercialitemacquisitionprocedures" = ' || NEW.commercialitemacquisitionprocedures || ',   "commercialitemtestprogram" = ' || NEW.commercialitemtestprogram || ',   "smallbusinesscompetitivenessdemonstrationprogram" = ' || NEW.smallbusinesscompetitivenessdemonstrationprogram || ',   "a76action" = ' || NEW.a76action || ',   "competitiveprocedures" = ' || NEW.competitiveprocedures || ',   "solicitationprocedures" = ' || NEW.solicitationprocedures || ',   "typeofsetaside" = ' || NEW.typeofsetaside || ',   "localareasetaside" = ' || NEW.localareasetaside || ',   "evaluatedpreference" = ' || NEW.evaluatedpreference || ',   "fedbizopps" = ' || NEW.fedbizopps || ',   "research" = ' || NEW.research || ',   "statutoryexceptiontofairopportunity" = ' || NEW.statutoryexceptiontofairopportunity || ',   "organizationaltype" = ' || NEW.organizationaltype || ',   "numberofemployees" = ' || NEW.numberofemployees || ',   "annualrevenue" = ' || NEW.annualrevenue || ',   "firm8aflag" = ' || NEW.firm8aflag || ',   "hubzoneflag" = ' || NEW.hubzoneflag || ',   "sdbflag" = ' || NEW.sdbflag || ',   "shelteredworkshopflag" = ' || NEW.shelteredworkshopflag || ',   "hbcuflag" = ' || NEW.hbcuflag || ',   "educationalinstitutionflag" = ' || NEW.educationalinstitutionflag || ',   "womenownedflag" = ' || NEW.womenownedflag || ',   "veteranownedflag" = ' || NEW.veteranownedflag || ',   "srdvobflag" = ' || NEW.srdvobflag || ',   "localgovernmentflag" = ' || NEW.localgovernmentflag || ',   "minorityinstitutionflag" = ' || NEW.minorityinstitutionflag || ',   "aiobflag" = ' || NEW.aiobflag || ',   "stategovernmentflag" = ' || NEW.stategovernmentflag || ',   "federalgovernmentflag" = ' || NEW.federalgovernmentflag || ',   "minorityownedbusinessflag" = ' || NEW.minorityownedbusinessflag || ',   "apaobflag" = ' || NEW.apaobflag || ',   "tribalgovernmentflag" = ' || NEW.tribalgovernmentflag || ',   "baobflag" = ' || NEW.baobflag || ',   "naobflag" = ' || NEW.naobflag || ',   "saaobflag" = ' || NEW.saaobflag || ',   "nonprofitorganizationflag" = ' || NEW.nonprofitorganizationflag || ',   "haobflag" = ' || NEW.haobflag || ',   "emergingsmallbusinessflag" = ' || NEW.emergingsmallbusinessflag || ',   "hospitalflag" = ' || NEW.hospitalflag || ',   "contractingofficerbusinesssizedetermination" = ' || NEW.contractingofficerbusinesssizedetermination || ',   "receivescontracts" = ' || NEW.receivescontracts || ',   "receivesgrants" = ' || NEW.receivesgrants || ',   "receivescontractsandgrants" = ' || NEW.receivescontractsandgrants || ',   "walshhealyact" = ' || NEW.walshhealyact || ',   "servicecontractact" = ' || NEW.servicecontractact || ',   "davisbaconact" = ' || NEW.davisbaconact || ',   "clingercohenact" = ' || NEW.clingercohenact || ',   "otherstatutoryauthority" = ' || NEW.otherstatutoryauthority || ',   "interagencycontractingauthority" = ' || NEW.interagencycontractingauthority || ',   "isserviceprovider" = ' || NEW.isserviceprovider || ';' ;

    EXECUTE statement USING NEW;
    RETURN NEW;
END
$$ LANGUAGE plpgsql;

DO $$
BEGIN
IF NOT EXISTS(
    SELECT 1
    FROM information_schema.triggers
    WHERE event_object_table = 'usaspending_contract'
    AND trigger_name = 'before_update_usaspending_contract_trigger'
) THEN
        CREATE TRIGGER before_update_usaspending_contract_trigger
            BEFORE UPDATE ON usaspending_contract
            FOR EACH ROW EXECUTE PROCEDURE usaspending_contract_update_child();
END IF;
END $$;

